# üìù Review Comment Annotation Guide

This folder (`reviews_to_label/`) contains review comments sampled for manual annotation. The goal is to analyze and classify comments generated by AI code review actions and human developers.

## üìÅ File Overview

Three CSV files are provided (ALL 50 samples):

- `sampled_file_level_review.csv`:  
  Review comments generated by file-level review actions.

- `sampled_patch_level_review.csv`:  
  Review comments generated by patch-level review actions.

- `sampled_human_review.csv`:  
  Review comments written by real developers.

Each file shares the same format and fields.

---

## üìÑ CSV Field Descriptions

| Field Name | Description |
|------------|-------------|
| `source_action` | The GitHub Action that generated the comment. <br/>For human-written comments, this refers to the action active in the project at the time of the comment. |
| `Comment_URL` | REST API endpoint of the comment (used to fetch metadata). |
| `Comment_HTML_URL` | Web link to the comment (for visual inspection). |
| `Original_Commit_id` | The commit at which the review comment was made. |
| `Diff_path` | The file path where the comment was placed. |
| `New_path` | The file path where the comment was placed. If New_path is NaN, it indicates that the file at Diff_path was not renamed in the commit identified by Merge_Commit_id. If a value is present, it represents the new file name after the file was renamed.
| `Review_Start_Line` | Start line of the reviewed code range (from `original_start_line` in API). <br/>If it is empty, it is a single line review;<br/>Not applicable to file-level review actions.<br/>This line number corresponds to the position of the modified line in the `Original_Commit_id` |
| `Review_End_Line` | End line of the reviewed code range (from `original_line` in API). <br/>Not applicable to file-level review actions.<br/>This line number corresponds to the position of the modified line in the `Original_Commit_id` |
| `Diff_hunk` | The code diff being reviewed: <br>‚Äì For patch-level and human comments: directly from the   `diff_hunk` in `Comment_URL`<br/>‚Äì ‚Äì For the single line review,  3 extra lines above the reviewed line as context (3 lines above for single-line, full range for multi-line. <br>‚Äì ‚Äì For the multiple line review,  use the scope determined by `Review_Start_Line` and `Review_End_Line`. <br/>‚Äì For file-level comments: the diff between `Review_BASE_SHA` and `Original_Commit_id`. |
| `Review_BASE_SHA` | Only applicable to file-level reviews:  <br>‚Äì For `mattzcarey/code-review-gpt`, this is always the PR's `BASE_SHA`.<br>‚Äì For other 2 file-level review action `anc95/ChatGPT-CodeReview` and `gvasilei/AutoReviewer`, this is obtained by checking if the original diff `diff_hunk`is a subset of the GitHub diff URL: <br>`https://api.github.com/repos/{repo_owner}/{repo_name}/compare/{base_sha}...{Original_Commit_id}` |
| `Body` | The full text of the review comment.<br/>In some cases, human-written comments containing code suggestions in the format of:<br/>`" ```suggestion (specific code block)``` "`<br/>will be manually rewritten to a more explicit form:<br/>`"I suggest changing\n ```\n{old_code}\n```\n to\n```\n{new_code}\n```"`<br/>This is done to help large language models (LLMs) better understand the suggested changes. |
| `Merge_Commit_id` | The final merged commit SHA of the pull request. |
| `Change_Until_Merged` | The file changes between `Original_Commit_id` and `Merge_Commit_id`. If the file at `Diff_path` was deleted in the commit identified by `Merge_Commit_id`, the value will be "File_Deleted".|
| `Whether it contain issues or suggestions` | **To be annotated:** `0` = No issue/suggestion, `1` = Contains issue/suggestion. |
| `List of issues or suggestions` | **To be annotated:** List of mentioned issues or suggestions (if any). |
| `Addressed Status Classification` | **To be annotated:** `0` = Not addressed, `1` = Partly addressed, `2` = Fully addressed. |
| `Detail` | **To be annotated (optional):** Description of which issues were addressed and how. |

---

## üß≠ Annotation Instructions

### Step 1: Understand the Comment  
Open the `Comment_HTML_URL` in the browser to view the full comment and its context.

For comments generated by **patch-level review actions** or written by **human developers**, the code snippet shown on the page is typically sufficient.  
However, for comments generated by **file-level review actions**, you may need to click **‚ÄúView reviewed changes‚Äù** on GitHub to see the full file diff context.  
In rare cases, GitHub may not accurately display the file changes. If there is any discrepancy between the GitHub UI and the `Change_Until_Merged` content, please **refer to `Change_Until_Merged` as the source of the real diff**.

### Step 2: Determine If It Contains Issues or Suggestions  
Analyze whether the comment provides any feedback, issue identification, or suggestions for improvement.  
‚Üí Annotate `Whether it contain issues or suggestions` as `1` or `0`.

### Step 3: Identify and Evaluate Suggestions (If Any)  
If the comment does contain issues or suggestions:

1. Use the `query_file_version.py` script to extract file content at both `Original_Commit_id` and `Merge_Commit_id`.
2. Compare the two versions using a diff tool like [https://www.jstoolset.com/diff](https://www.jstoolset.com/diff).
3. Analyze whether the identified issues/suggestions have been addressed.

‚Üí Fill in:
- `List of issues or suggestions`
- `Addressed Status Classification`
- `Detail` (if applicable)

---
## ‚åöÔ∏è 2025.03.26 Update:

During the annotation process, we identified an issue with constructing the `Diff_hunk` for multi-line reviews, which did not always align with the changes displayed on the `Comment_HTML_URL` web page.
This issue has been resolved, and the annotation files have been updated accordingly.
This fix only affects the `Diff_hunk` portion of some multi-line patch-level and human review comments; all other content and order remain unchanged.
If existing judgments were made based on ‚ÄúOpen the `Comment_HTML_URL` in the browser to view the full comment and its context,‚Äù the annotation results will not be affected.

---

Thanks to ChatGPT for helping generate this cute ReadMe. üòä
